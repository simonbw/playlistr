maxkir.ChecklistNodeToggle=Object.extend({},maxkir.NodeToggle),Object.extend(maxkir.ChecklistNodeToggle,{updateServer:function(a,b){if(this.skip_server)return;if(!this._server_collapse_expand){this._to_update={},this._to_update.expand={},this._to_update.collapse={};var c=this,d=function(a){var b="";for(var d in c._to_update[a])d>0&&(b+=d+",");c._to_update[a]={},b.length>0&&(b=b.substr(0,b.length-1),maxkir.info("Run "+a+" for "+b),new maxkir.AjaxCommand("/checklists/"+maxkir.checklist_id+"/"+a+"_all",{parameters:"only="+b}))};this._server_collapse_expand=maxkir.delay_action(function(){d("expand"),d("collapse")},300)}b=="expand"?(this._to_update.expand[a]=!0,delete this._to_update.collapse[a]):(this._to_update.collapse[a]=!0,delete this._to_update.expand[a]),this._server_collapse_expand.start()},without_server:function(a){var b=this.skip_server;this.skip_server=!0;try{a(),maxkir.debug("without server")}finally{this.skip_server=b}},expand:function(a){this.expandNode("task_"+a)},collapse:function(a){this.collapseNode("task_"+a)},expandNode:function(a,b){if(!b){var c=maxkir.tree_model.getParent(a);if(!c){var d=maxkir.Task.data(maxkir.Task.id(a));d&&d.parent_id&&(c="task_"+d.parent_id)}this.updateDataModel(a,!1),c&&c!==a&&maxkir.ChecklistNodeToggle.expandNode(c)}return maxkir.NodeToggle.expandNode.call(this,a)},ulSelector:function(){return"ul.dndUl"},onExpand:function(a){this.updateDataModel(a,!1),this.updateUIData(a),this.updateServer(maxkir.Task.id(a),"expand")},onCollapse:function(a){this.updateDataModel(a,!0),this.updateUIData(a),this.updateServer(maxkir.Task.id(a),"collapse"),this.fix_selection_delayed()},fix_selection_delayed:function(){this._selection_fixer||(this._selection_fixer=maxkir.delay_action(function(){maxkir.tree_nav.fix_selection(!0)},10)),this._selection_fixer.start()},updateDataModel:function(a,b){var c=maxkir.Task.data(maxkir.Task.id(a));c&&(c.collapsed=b)},updateUIData:function(a){var b=maxkir.Task.data(maxkir.Task.id(a));if(!b)return;var c=$(a).down(this.ulSelector());c&&(b.collapsed||c.innerHTML===""&&maxkir.Task.renderer(maxkir.Task.id(a)).updateContent(!0))},toggle_all:function(a){a.innerHTML.match(/Expand/)?(a.innerHTML="Collapse all",this.expand_all()):(a.innerHTML="Expand all",this.collapse_all())},collapse_all:function(){this.without_server(function(){this._affected_node_ids=[],maxkir.TaskFocus&&maxkir.TaskFocus.focusedTaskId()?this.collapse_deep("task_"+maxkir.TaskFocus.focusedTaskId()):maxkir.NodeToggle.collapse_all.call(this)}.bind(this)),this._change_all("collapse_all")},expand_all:function(a){this.without_server(function(){this._affected_node_ids=[],maxkir.TaskFocus&&maxkir.TaskFocus.focusedTaskId()?this.expand_deep("task_"+maxkir.TaskFocus.focusedTaskId(),a):maxkir.NodeToggle.expand_all.call(this,a)}.bind(this)),this._change_all("expand_all")},_change_all:function(a){maxkir.CommandProcessor.flushDelayedQueue();var b=this._affected_node_ids.map(function(a){return maxkir.Task.id(a)});new maxkir.AjaxCommand("/checklists/"+maxkir.checklist_id+"/"+a,{parameters:"only="+b.join(",")})},_f:null}),maxkir.checklist=maxkir.checklist||{},maxkir.DetailsMode.save_state=function(a){maxkir.checklist.set_option("show_details",a)},maxkir.checklist.HideCompleted=Object.extend({},maxkir.BaseHideCompleted),Object.extend(maxkir.checklist.HideCompleted,{_skip_hide:{},should_ignore:function(){return $("findInput")&&/in: ?(all|closed)/.match($F("findInput"))},is_hide:function(){return this.should_ignore()?!1:maxkir.BaseHideCompleted.is_hide.call(this)},update_visibility_all:function(){maxkir.Task.foreach(function(a){this.update_visibility(a.id)}.bind(this)),maxkir.tree_model.on_repaint()},is_hidden:function(a){return this._skip_hide[a]?!1:maxkir.BaseHideCompleted.is_hidden.apply(this,arguments)},hide_completed:function(a,b){this.set_hide(a),a&&b&&(this._skip_hide={}),this.update_visibility_all(),b&&maxkir.checklist.set_option("hide_completed",a)},toggle_hide:function(a){this.hide_completed(!this.is_hide(),a)},skip_hide_if_closed:function(a){a.status&&(this._skip_hide[a.id]="1")},show_hide_message:function(a){var b=maxkir.Task.data(a);this.is_hide()&&b&&b.status&&new maxkir.ui.Message("All subtasks were completed<br>The parent task will disappear after page reload.")}}),maxkir.checklist.ListBulletStyle={change_style:function(a){var b=a.options[a.selectedIndex].value;this.set_style(b,!0)},set_current_option:function(a){for(var b=0;b<a.options.length;b++){var c=a.options[b].value;if(c==this._bullet_style){a.selectedIndex=b;break}}},set_style:function(a,b){this._bullet_style=a,$("tasks_block").removeClassName("numberedList"),$("tasks_block").removeClassName("bulletsList"),$("tasks_block").removeClassName("boxesList"),a=="show_numbered"?$("tasks_block").addClassName("numberedList"):a=="show_bullets"?$("tasks_block").addClassName("bulletsList"):a=="show_boxes"&&$("tasks_block").addClassName("boxesList"),b&&["show_bullets","show_boxes","show_numbered"].forEach(function(b){maxkir.checklist.set_option(b,a==b)})}},maxkir.checklist.CompletedDown={is_enabled:function(){return this._completed_down},completed_down:function(a,b){this._completed_down=a,b&&(maxkir.checklist.set_option("completed_down",a),maxkir.Task.sort_tasks_under($("parentTask_0")),$("parentTask_0").select("ul").each(function(a){maxkir.Task.sort_tasks_under(a)}))}},maxkir.TaskRendererContext={is_hidden:function(a){return maxkir.checklist.HideCompleted.is_hidden(a.id)}},maxkir.ui.ListActionsPopup=maxkir.ui.create_popup(!0,{popup_width:270,refresh:function(){var a=this.win;if(!this.popupContent){var b="listActionsPopupData";$(b)||maxkir.error("Cannot find layout '"+b+"'"),this.popupContent=$(b).innerHTML,$(b).innerHTML=""}a.getContent().update(this.popupContent),this.setupSelection()},onShow:function(){this.init_data_links()}}),maxkir.ui.ActionsPopup=maxkir.ui.create_popup(!0,{popup_width:300,showAdvanced:function(){var a=$(document.querySelector(".actionsPopupData"));if(!a)return;var b=a.select("li.hidden"),c=maxkir.ui.ActionsPopup.win;c.setSize(c.getSize().width,c.getSize().height+27*(b.length-2.5)),b.each(function(a){a.removeClassName("hidden")}),maxkir.ui.ActionsPopup.up(),maxkir.ui.ActionsPopup.scrollToShow(400),setTimeout(function(){$(a).addClassName("showAdvanced")},10)},get_actions_data:function(){var a=function(){return maxkir.selection.task_ids_no_can_run_check().length},b=function(){return a()===0},c=function(){return a()!==1},d=function(){return c()?!0:maxkir.Task.is_leaf(maxkir.cmd.task_id())}.bind(this),e={text:"",cmd:null,disabled:c},f={text:"",cmd:null,disabled:c,clazz:"advanced hidden"};this.actions_data=[];if(a()===1||maxkir.TaskFocus.is_active()){var g=c()||maxkir.TaskFocus.focusedTaskId()===maxkir.cmd.task_id();g?this.actions_data.push({text:'<i class="menuPopupList__icon fas fa-thumbtack focusIcon"></i>'+I18N("js_actions.unhoist"),shortcut:"shift+left",cmd:function(){maxkir.cmd.close_all_popups(),maxkir.TaskFocus.remove_focus(!0,!0)}}):this.actions_data.push({text:'<i class="menuPopupList__icon far fa-thumbtack focusIcon"></i> '+I18N("js_actions.hoist"),shortcut:"shift+right",cmd:function(){maxkir.cmd.close_all_popups(),maxkir.TaskFocus.add_focus(maxkir.cmd.task_id())}}),this.actions_data.push(e)}return maxkir.isMobile?this.actions_data=this.actions_data.concat([{text:"  "+I18N("js_actions.edit_text"),shortcut:"double-tap",cmd:function(){maxkir.cmd.close_all_popups(),maxkir.cmd.edit_task_or_note()},disabled:c},{text:"  "+I18N("js_actions.add_item_text"),shortcut:"enter",cmd:function(){maxkir.cmd.close_all_popups(),maxkir.cmd.add_task()},disabled:c},{text:"  "+I18N("js_actions.add_subitem_text"),shortcut:"shift+enter",cmd:maxkir.cmd.add_subtask,disabled:c}]):this.actions_data=this.actions_data.concat([{text:"  "+I18N("js_actions.add_item_below"),shortcut:"enter",cmd:function(){maxkir.cmd.close_all_popups(),maxkir.cmd.add_task()},disabled:c},{text:"  "+I18N("js_actions.add_item_above"),shortcut:"alt-enter",cmd:function(){maxkir.cmd.close_all_popups(),maxkir.cmd.add_task(!0)},disabled:c}]),this.actions_data=this.actions_data.concat([{text:"     "+I18N("js_actions.note_text"),title_text:I18N("js_actions.note_text_title"),shortcut:"nn",cmd:maxkir.cmd.view_add_note,disabled:c},{text:maxkir.is_pro?"     "+I18N("js_actions.attachment_text"):"     "+I18N("js_actions.attachment_PRO_text"),title_text:I18N("js_actions.attachment_text_title"),shortcut:"at",cmd:maxkir.cmd.attach_file,disabled:function(){return!maxkir.is_pro||c()}.bind(this)},e,{text:"     "+I18N("js_actions.color_text"),title_text:I18N("js_actions.color_text_title"),shortcut:"1 ... 9",cmd:function(){maxkir.ui.ColorPopup.toggle_popup(this.anchor_element.up(".coreDiv"))}.bind(this),disabled:b},{text:"     "+I18N("js_actions.due_text"),title_text:I18N("js_actions.due_text_title"),shortcut:"dd",cmd:maxkir.cmd.view_add_due,disabled:b},{text:"     "+I18N("js_actions.tag_text"),title_text:I18N("js_actions.tag_text_title"),shortcut:"tt",cmd:maxkir.cmd.view_tags,disabled:b},{text:maxkir.is_pro?"     "+I18N("js_actions.assignee_text"):"     "+I18N("js_actions.assignee_PRO_text"),title_text:I18N("js_actions.assignee_text_title"),shortcut:"ae",cmd:maxkir.cmd.assign_user,disabled:function(){return!maxkir.is_pro||maxkir.temporary||b()}.bind(this)},{text:"     "+I18N("js_actions.progress_counter_text"),title_text:I18N("js_actions.progress_counter_text_title"),shortcut:"pc",cmd:maxkir.cmd.toggle_progress_counter,disabled:b},f,{text:"     "+I18N("js_actions.move_text"),title_text:I18N("js_actions.move_text_title"),shortcut:"mm",cmd:maxkir.cmd.move_to_another_list,disabled:b,clazz:"advanced hidden"},{text:"     "+I18N("js_actions.extract_text"),title_text:I18N("js_actions.extract_text_title"),shortcut:"xx",cmd:maxkir.cmd.extract_checklist,disabled:d,clazz:"advanced hidden"},{text:"  "+I18N("js_actions.sort_text"),title_text:I18N("js_actions.sort_text_title"),shortcut:"ss",cmd:maxkir.cmd.view_sort,disabled:c,clazz:"advanced hidden"},{text:"     "+I18N("js_actions.import_text"),title_text:I18N("js_actions.import_text_title"),shortcut:"im",disabled:c,cmd:function(){maxkir.cmd.import_items()}.bind(this),clazz:"advanced hidden"},{text:"     "+I18N("js_actions.export_text"),title_text:I18N("js_actions.export_text_title"),shortcut:"ex",cmd:function(){maxkir.cmd.export_items()}.bind(this),clazz:"advanced hidden"},f,{text:"     "+I18N("js_actions.reopen_completed_subtasks"),title_text:I18N("js_actions.reopen_completed_subtasks_title"),shortcut:"reset",cmd:maxkir.cmd.reset,disabled:d,clazz:"advanced hidden"},{text:"     "+I18N("js_actions.delete_completed_subtasks"),title_text:I18N("js_actions.delete_completed_subtasks_title"),shortcut:"wipe",cmd:maxkir.cmd.wipe_closed,disabled:d,clazz:"advanced hidden"},{text:'<span class="menuPopupList__icon far fa-link"></span>'+I18N("js_actions.get_item_permalink"),title_text:"",shortcut:"lc",disabled:c,cmd:maxkir.cmd.link_copy,clazz:"specialItem"},{text:I18N("js_actions.more"),cmd:maxkir.ui.ActionsPopup.showAdvanced,clazz:"more"}]),this.actions_data},buildActions:function(){var a="",b=this.get_actions_data(),c=function(a){return a+1<b.length&&b[a+1].cmd==null};for(var d=0;d<b.length;d++){var e=b[d],f="";e.cmd==null?a+="<li class='separator "+(e.clazz||"")+"'></li>":(e.shortcut&&(f="<span class='shortcut' onclick='maxkir.click_link(this.parentNode); return false;'>"+e.shortcut+"</span>"),a+="<li class='",c(d)&&(a+=" lastInGroup"),a+=" "+(e.clazz||""),a+="' ",e.title_text&&(a+='title="'+e.title_text+'"'),a+=">"+f+"<a href='#' id='taskActionId"+d+"'>"+e.text+"</a></li>")}return a},refresh:function(){this.popupContent||(this.popupContent=new Template($("actionsPopupData").innerHTML),$("actionsPopupData").innerHTML=""),this.win.getContent().update(this.popupContent.evaluate({task_actions:this.buildActions()})),this.setupSelection()},onShow:function(){this.install_handlers(),this.scrollToShow()},onHide:function(){this.remove_handlers()},install_handlers:function(){var a=this.get_actions_data();for(var b=0;b<a.length;b++){if(!$("taskActionId"+b))continue;var c=a[b];if(c.disabled&&c.disabled()){var d=$($("taskActionId"+b).parentNode);d.addClassName("disabled"),d.title=""+I18N("js_actions.action_disabled_text")}else(function(a){a.cmd&&($("taskActionId"+b).onclick=function(b){return a.cmd.call(this),b&&Event.stop(b),!1})})(c)}},remove_handlers:function(){var a=this.get_actions_data();for(var b=0;b<a.length;b++)$("taskActionId"+b)&&($("taskActionId"+b).onclick=null)},doOpen:function(a){maxkir.click_link($(a))}}),maxkir.ui.OptionsPopup=maxkir.ui.create_popup(!0,{popup_width:280,refresh:function(){this.popupContent||(this.popupContent=$("optionsPopupData").innerHTML,$("optionsPopupData").innerHTML=""),this.win.getContent().update(this.popupContent),$("hide_completed").checked=maxkir.checklist.HideCompleted.is_hide(),$("completed_down").checked=maxkir.checklist.CompletedDown.is_enabled(),$("show_details").checked=maxkir.DetailsMode.on(),$("zen_mode").checked=maxkir.ZenMode.enabled(),$("enable_markdown")&&($("enable_markdown").checked=maxkir.Lists.data(maxkir.checklist_id).markdown()),$("progress_count")&&($("progress_count").checked=maxkir.Lists.data(maxkir.checklist_id).progress_counter());var a=this._select(this.win.getContent());a&&(maxkir.checklist.ListBulletStyle.set_current_option(a),this._install_keyboard_changer(a)),this.setupSelection()},_select:function(a){var b=$(a).select(".listStyleControl");return b.length==1?b[0]:null},_install_keyboard_changer:function(a){var b=a.on("keydown",function(b){var c=b.keyCode;switch(c){case 38:case 37:Event.stop(b),a.selectedIndex>0?a.selectedIndex--:a.selectedIndex=a.options.length-1,a.dispatchEvent(new Event("change"));break;case 40:case 39:Event.stop(b),a.selectedIndex<a.options.length-1?a.selectedIndex++:a.selectedIndex=0,a.dispatchEvent(new Event("change"));break;case 13:Event.stop(b),a.blur()}});this.win.addDisposerOnClose(function(){b.stop()})},doOpen:function(a){var b=this._select(a);b?b.focus():maxkir.ui.PopupSelectionSupport.doOpen.apply(this,arguments)}}),maxkir.ui.ListSortPopup=maxkir.ui.create_sort_popup({getCurrentId:function(a){return null},getSettings:function(){var a=maxkir.cmd.task_id();return[{sortId:"color",name:I18N("sort.by_color"),title:I18N("sort.by_color_title"),switchTo:function(b,c,d){maxkir.cmd.sort_by("color",a)}},{sortId:"alpha",name:I18N("sort.by_alphabet"),title:I18N("sort.by_alphabet_title"),switchTo:function(b,c,d){maxkir.cmd.sort_by("alpha",a)}},{sortId:"due",name:I18N("sort.by_due"),title:I18N("sort.by_due_title"),switchTo:function(b,c,d){maxkir.cmd.sort_by("due",a)}},{sortId:"updated",name:I18N("sort.by_updated"),title:I18N("sort.by_updated_title"),switchTo:function(b,c,d){maxkir.cmd.sort_by("updated",a)}}]}}),function(){maxkir.run_after(maxkir.ui.ListSortPopup,"setContent",function(){var a=document.querySelector(".sortPopupList");if(a){var b=maxkir.user.get_boolean_pref("shallow_sorting")?" checked ":"",c="<em class=\"far fa-info-circle depthOption__helpIcon hoverPopup\" data-popup-id='textPopup' data-text-key='sort.js_shallow_help'></em>",d='<li class="sortListItem depthOption" id="shallowSorting">'+c+"<label>"+'<input type="checkbox" '+b+' class="depthOption__input" onchange="maxkir.user.set_user_prefs(\'shallow_sorting\', this.checked);">'+I18N("sort.shallow_option")+"</label></li>",e=document.createElement("div");e.innerHTML="<li class='separator'></li>",a.appendChild(e.childNodes[0]),e.innerHTML=d,a.appendChild(e.childNodes[0])}var f=document.querySelector(".intro.inMenu");f.innerHTML=maxkir.cmd.task_id()?I18N("sort.dialog_title_branch"):I18N("sort.dialog_title_list"),this.scrollToShow()});var a=maxkir.ui.ListSortPopup.doOpen;maxkir.ui.ListSortPopup.doOpen=function(b,c){if(b.id==="shallowSorting"){maxkir.ui.PopupSelectionSupport.doOpen.call(this,b,c);return}a.call(this,b,c)}}(),maxkir.checklist=maxkir.checklist||{},maxkir.checklist.Dnd={install:function(a){this.no_dnd=!a&&Prototype.Browser.IE&&maxkir.Task.task_count()>200,this.start_dnd()},updateStructure:function(){maxkir.CommandProcessor.add2QueueWithTimeout("reorder",1e3,maxkir.checklist.Dnd._doServerUpdate,function(){return maxkir.EditTracker.is_editing()||maxkir.key_monitor.pressed("ctrl")||maxkir.key_monitor.pressed("meta")?(maxkir.info("Postpone reorder: ",maxkir.EditTracker.is_editing(),maxkir.key_monitor.pressed("ctrl"),maxkir.key_monitor.pressed("meta")),!1):!0})},stop_dnd:function(){if(maxkir.read_only||this.no_dnd||!this._installed)return;maxkir.debug("stop Dnd >>> "+new Date),Droppables.drops=[],Draggables.drags=[],Draggables.unregister("fff");var a=Draggables.unregister;Draggables.unregister=Prototype.emptyFunction,this._stopShiftMonitor(),Sortable.destroy("parentTask_0"),Draggables.unregister=a,maxkir.debug("stop Dnd <<< "+new Date),this._installed=!1},start_dnd:function(){if(maxkir.read_only||this.no_dnd)return;maxkir.debug("install Dnd >>> "+new Date);if(this._installed){maxkir.info("Attempt to install existing Dnd, cancel");return}Sortable.create("parentTask_0",{tree:!0,only:"dndNode",treeTagClass:"dndUl",scroll:window,elements:maxkir.checklist.Dnd._elements_for_tasks(),onUpdate:function(){this.updateStructure()}.bind(this)}),this._startShiftMonitor(),maxkir.debug("install Dnd <<< "+new Date),this._installed=!0},addTreeNode:function(a){if(this.no_dnd)return;var b=Sortable.options(a),c={overlap:b.overlap,containment:b.containment,tree:b.tree,hoverclass:b.hoverclass,onHover:Sortable.onHover},d={revert:!0,quiet:b.quiet,scroll:b.scroll,scrollSpeed:b.scrollSpeed,scrollSensitivity:b.scrollSensitivity,delay:b.delay,ghosting:b.ghosting,constraint:b.constraint,handle:b.handle};b.draggables.push(new Draggable(a,d)),Droppables.add(a,c),b.tree&&(a.treeNode=$("parentTask_0"))},_elements_for_tasks:function(){var a=[];return maxkir.Task.foreach(function(b){var c=$("task_"+b.id);c&&a.push(c)}),a},_doServerUpdate:function(){maxkir.CommandProcessor.add2Queue(new maxkir.ReorderCommand)},_startShiftMonitor:function(){this._stopShiftMonitor();var a=this,b=function(){a.dndActive&&(a.dndActive=!1,$("parentTask_0").removeClassName("dndActive")),$("parentTask_0").removeClassName("dndActiveStarted")};this.keydownHandler=document.on("keydown",function(c){b();if(a.starting){clearTimeout(a.starting),a.starting=null,$("parentTask_0").addClassName("dndActiveStarted");return}c.keyCode==16&&!c.metaKey&&!c.ctrlKey&&!c.altKey?($("parentTask_0").addClassName("dndActiveStarted"),a.starting=setTimeout(function(){a.starting=null,$("parentTask_0").removeClassName("dndActiveStarted"),maxkir.key_monitor.pressed("shift")&&(a.dndActive=!0,$("parentTask_0").addClassName("dndActive"))},2e3)):b()}),this.keyupHandler=document.on("keyup",function(a){setTimeout(function(){maxkir.key_monitor.pressed("shift")||b()},10)}),window._blur_dnd_installed||(window._blur_dnd_installed=!0,Event.observe(window,"blur",function(){b()}))},_stopShiftMonitor:function(){this.keydownHandler&&(this.keydownHandler.stop(),delete this.keydownHandler),this.keyupHandler&&(this.keyupHandler.stop(),delete this.keyupHandler)}},maxkir.Jobs={_jobs:{},add_job:function(a,b,c){if(b())c();else{if(this._jobs[a])return;var d=this;this._jobs[a]=setTimeout(function(){delete d._jobs[a],d.add_job(a,b,c)},300)}}},maxkir.add_task={local2real:{},is_adding:function(){var a=$("add_task");return a.parentNode.parentNode&&a.parentNode.parentNode.tagName==="LI"},change_parent:function(a,b){b||(b=0);var c=$("task_content"),d=c.value,e=maxkir.get_selection_range(c);maxkir.add_task.hide_add(),maxkir.add_task.show_add(a,b),c.value=d,e[1]<=d.length&&maxkir.set_selection_range($("task_content"),e)},show_add:function(a,b){b||(b=-1),maxkir.debug("maxkir.add_task.show_add("+$A(arguments)+")");if(a>0&&!$("task_"+a))return;$("task_parent_id").value=a,maxkir.add_task.insert_after=b,maxkir.add_task.hide_add(),maxkir.EmptyList.hide(),$$(".withActionMenu").length&&$$(".withActionMenu")[0].removeClassName("withActionMenu"),a>0&&maxkir.ChecklistNodeToggle.expand(a);var c=$("parentTask_"+a),d=$("task_"+b),e;if(d)e=this._createLi_add(),d.parentNode.insertBefore(e,d.nextSibling);else if(c)e=this._createLi_add(),c.insert({top:e});else{maxkir.warn("Cannot find parent node for parentId:"+a+", anchorId:"+b);return}$("add_task").style.display="block",this._repaintTopFrame(e);var f=$("task_content");f.placeholder=maxkir.placeholder("add_item",I18N("add_placeholder_1"),I18N("add_placeholder_2"),maxkir.MAC?I18N("add_placeholder_3_m"):I18N("add_placeholder_3"),maxkir.MAC?I18N("add_placeholder_4_m"):I18N("add_placeholder_4"),I18N("add_placeholder_5"),I18N("add_placeholder_6")),f.value="",this.paste_was_used=!1,this.task_text_fixer=maxkir.Task.task_text_fixer(),maxkir.set_selection(f,0,0);var g=maxkir.DataCompleter.create_completer(f,{task_content_editing:!0,checklist_id:maxkir.checklist_id,afterUpdateElement:this.task_text_fixer.onElementComplete});g.addHandler(maxkir.UploadCompleter),g.addHandler(maxkir.ListCompleter),g.addHandler(maxkir.LinkCompleter),maxkir.EditTracker.start_editing("task_content"),maxkir.scrollTo($("add_task")),maxkir.tree_nav.hide_selection(),f.maxkir_textarea||maxkir.add_task.installKbdHandler(),f.maxkir_textarea.options.onEscUndo=function(c){maxkir.add_task.show_add(a,b),f.value=c,f.maxkir_textarea.fix_multiline_and_height(!0)},f.maxkir_textarea.start(),f.maxkir_textarea.prepare_submit_and_cancel(),this._install_helper_for_smart_syntax()},_repaintTopFrame:function(a){maxkir.tree_nav.refresh_global_ui()},_idx:0,_createLi_add:function(){var a=$("add_task"),b=this.create_temp_node();return $("local_new_id").value=b.id,a.parentNode.removeChild(a),b.firstChild.appendChild(a),b},create_tmp_task_id:function(){return this._idx++,"task_new_"+this._idx},create_temp_node:function(){var a=document.createElement("LI");a.className="task",a.id=this.create_tmp_task_id();var b=document.createElement("DIV");return b.className="coreDiv",a.appendChild(b),a},hide_add:function(){$("task_content").maxkir_textarea&&$("task_content").maxkir_textarea.dispose(),this._dispose_helper_for_smart_syntax(),maxkir.DataCompleter.uninstall($("task_content")),maxkir.EditTracker.stop_editing("task_content"),$("task_content").maxkir_textarea&&$("task_content").maxkir_textarea.dispose(),$("task_content").value="";if(maxkir.add_task.is_adding()){var a=$("add_task"),b=a.parentNode.parentNode;maxkir.add_task._remove_from_tree();var c=b.parentNode;return c.removeChild(b),this._repaintTopFrame(c),maxkir.tree_nav.fix_selection(),maxkir.EmptyList.update_view(),!0}return!1},_install_helper_for_smart_syntax:function(){var a=$("task_content");a.inputHints=new maxkir.ui.InputHints(a)},_dispose_helper_for_smart_syntax:function(){var a=$("task_content");a&&a.inputHints&&(a.inputHints.dispose(),a.inputHints=null)},_remove_from_tree:function(){var a=$("add_task");a.remove(),$$(".hiddenContainer")[0].appendChild(a)},create_task:function(a,b){var c=$F("task_content");if(/^\s*$/.match(c)){maxkir.add_task.hide_add();return}this._remove_from_tree();var d=$F("local_new_id"),e=this.get_position($(d)),f=$F("task_parent_id");return c=this.task_text_fixer.fix_content(c),this._create_task_from_content(c,d,f,e,b,this.paste_was_used),maxkir.add_task.hide_add(),a&&maxkir.tree_nav.set_selection(d,!1),!1},_create_task_from_content:function(a,b,c,d,e,f){var g=function(){this._create_task_on_server(a,b,c,d,e)}.bind(this),h=a.trim().split(/\n+/).length;if(f&&h>=2&&!e&&!maxkir.UserPrefs.disable_multiline_import){var i=maxkir.temporary?"":I18N("add_multiline_dialog_help");maxkir.ui.Dialog.confirm(I18N("add_multiline_dialog_title"),"",function(e){var f=$("ok_button_dialog");f&&(f.disabled=!0),maxkir.cmd.run_import(maxkir.checklist_id,c,d,a,{},function(){$(b)&&$(b).remove(),e.close()})},I18N("add_multiline_dialog_ok"),i,function(a){},function(){},{cancelLabel:I18N("add_multiline_dialog_cancel"),cancel:g})}else g()},create_task_from_content:function(a,b){if(maxkir.Task.read_only(b.id)){maxkir.Task.no_write_access_message();return}var c=this.create_temp_node();$("task_"+b.id).insert({after:c}),this._create_task_from_content(a.trim(),c.id,b.parent_id,b.position+1,null,!0),maxkir.tree_nav.set_selection(c.id,!1)},_create_task_on_server:function(a,b,c,d,e){$(b).innerHTML=(new maxkir.TaskRenderer({id:b.substring(5),checklist_id:maxkir.checklist_id,content:a.escapeHTML().gsub(/[\n\r]$/,""),status:0,position:d,details:{}})).full_task_content(),$(b).down(".coreDiv").addClassName("addInProgress");var f="local_new_id="+b+"&task[parent_id]="+c+"&task[content]="+encodeURIComponent(a)+"&task[position]="+d;maxkir.CommandProcessor.add2Queue(new maxkir.AddTaskCommand(f,b,e))},get_position:function(a){Element.cleanWhitespace($(a).parentNode);var b=$(a).parentNode.childNodes;for(var c=0;c<b.length;c++)if(b[c].id==a.id){if(c==0)return 1;var d=maxkir.checklist.CompletedDown.is_enabled();if(!d){var e=maxkir.Task.data(maxkir.Task.id(b[c-1].id));return e?e.position+1:c+1}for(var f=c-1;f>=0;f--){var g=maxkir.Task.data(maxkir.Task.id(b[f].id));if(g&&!g.status)return g.position+1}return 1}return 1},empty_list:function(){return Object.keys(maxkir.TaskData).length==0},show_if_empty_list:function(){if(maxkir.EditTracker&&maxkir.EditTracker.is_editing())return;maxkir.EmptyList.empty_list()?maxkir.EmptyList.update_view():maxkir.tree_nav.fix_selection()},installKbdHandler:function(){if(maxkir.read_only)return;var a=$("task_content");maxkir.ui.EditorShortcuts(a,maxkir.checklist_id),a.maxkir_textarea=new maxkir.ui.Textarea("task_content",{max_width:null,onCancel:function(a){maxkir.add_task.hide_add(),Event.stop(a)},onSubmit:function(){if($("task_content").value.blank()){this.hide_add();return}this.create_task(!0),maxkir.UserPrefs.require_2nd_enter_to_add||setTimeout(function(){maxkir.cmd.add_task()},20)}.bind(maxkir.add_task)}),$("task_content").on("paste",function(a){this.paste_was_used=!0}.bind(this)),Event.observe(document.body,"mousedown",function(a){var b=Event.element(a);if(maxkir.add_task.is_adding()&&!maxkir.is_form_control(b)){if(b&&b.hasClassName("editor_cancel"))return;if(b&&b.up("ul.menuPopupList"))return;if(maxkir.ui.Popups.noHideOnClick(b))return;maxkir.add_task.create_task(!0)}}.bindAsEventListener(this))},update_model:function(a){var b=maxkir.Task.data(a);if(b){var c=maxkir.Task.data(b.parent_id);if(c){c.tasks.push(a);while(c)c.status=0,c=maxkir.Task.data(c.parent_id)}}}},maxkir.AddTaskCommand=function(a,b,c){maxkir.SyncronousAjaxCommand.call(this,"/checklists/"+maxkir.checklist_id+"/tasks.js",{parameters:a,evalJS:"force",onSuccess:maxkir.Notifications.enable,onComplete:function(){try{var a=maxkir.add_task.local2real[b];maxkir.info("Added task "+a+" instead of "+b);if(a){maxkir.add_task.update_model(a);var d=$(b);d.addClassName("dndNode");var e=maxkir.Task.isDivider(a)?"dividerClass":"nonDivider";d.addClassName(e),d.id="task_"+a,maxkir.Task.updateTask(a,!0),maxkir.ProgressCounter?maxkir.ProgressCounter.on_task_updated(maxkir.Task.data(a)):maxkir.Task.updateParents(maxkir.tree_model.getParent("task_"+a)),maxkir.add_task.insert_after===maxkir.Task.id_str(b)&&(maxkir.add_task.insert_after=a),b===maxkir.tree_nav.get_single_selection()&&(maxkir.tree_nav.set_selection("task_"+a,maxkir.add_task.is_adding()),maxkir.tree_nav.save_selection_position());var f=$(d.parentNode).identify();maxkir.checklist.resort_children_of(f),maxkir.checklist.Dnd.addTreeNode(d),c&&c.call(this,a)}}catch(g){maxkir.error("Error while adding a task"),maxkir.exception(g)}}.bind(this)})},maxkir.extend(maxkir.AddTaskCommand,{},maxkir.SyncronousAjaxCommand),maxkir.EmptyList={update_view:function(){this.empty_list()?this.show()||maxkir.cmd.add_task():this.hide()},empty_list:function(){return Object.keys(maxkir.TaskData).length===0},hide:function(){var a=$("emptyList");a&&a.hide()},show:function(){var a=$("emptyList");return a?(a.show(),!0):!1}},maxkir.ui.ExportPopup=maxkir.ui.create_popup(!1,{popup_width:440,refresh:function(){var a=this.win;this.popupContent||(this.popupContent=$("exportPopup").innerHTML,$("exportPopup").innerHTML=""),a.getContent().update(this.popupContent),maxkir.form_state("exportForm").restore_state(),$("export_details").checked=maxkir.DetailsMode.on()},onShow:function(){var a=this.win.getContent().down(".exportOptions input:checked");a||(a=this.win.getContent().down(".exportOptions input"),a.click()),this._update_options_view(null,a),a.focus();var b=maxkir.delay_action(this._run_export.bind(this),150);$("exportForm").on("change","input",function(a){Event.stop(a),b.start()}),$("exportOptions").on("click","input",this._update_options_view.bind(this)),$("max_heading").on("change",function(){this._generate_headings().checked=!0,this._update_options_view(),b.start()}.bind(this)),this._generate_headings().on("change",this._update_options_view.bind(this)),$(document.querySelector(".exportSettings__toggler")).on("click",function(a){a.preventDefault(),this._show_options=!this._show_options,this._update_options_view()}.bind(this)),this._prepare_copy_function(),this._run_export(),this.scrollToShow()},onHide:function(){$("exportForm").stopObserving(),$("exportOptions").stopObserving(),$(document.querySelector(".exportSettings__toggler")).stopObserving()},_prepare_copy_function:function(){$("copy_button").on("click",function(a){document.execCommand("copy"),this.hide_popup()}.bind(this))},_update_options_view:function(){var a=$("exportForm");a.style.maxHeight="";var b=document.querySelector("input[name=exportKind]:checked");document.querySelector(".exportSettings__prefix").innerHTML=b.parentElement.innerText,b.value===".rtf"?$("exportLink").hide():$("exportLink").show(),$$(".exportSettings__group").invoke("hide"),this._show_options&&($$("."+b.id+"_Options").length?$$("."+b.id+"_Options")[0].show():$$(".exportOptionsBox_Common")[0].show()),this._update_generate_headings(),$("exportLink").href=this._build_url(),this.win.updateHeight();var c=a.offsetHeight;a.style.maxHeight=c+"px",this.scrollToShow()},_generate_headings:function(){return $("generateHeadings")},_update_generate_headings:function(){var a=$("generateHeadings").checked;$("keep_explicit_headings_on_conflict").disabled=!a,$("headers_with_subitems_only").disabled=!a,$("keep_explicit_headings_on_conflict").parentNode.classList[a?"remove":"add"]("disabled"),$("headers_with_subitems_only").parentNode.classList[a?"remove":"add"]("disabled")},_build_url:function(){var a="/checklists/"+this.options.checklist_id+"/export",b=$$("input[name=exportKind]:checked")[0],c=b.value;return this._rtf=!1,c===".rtf"&&(this._rtf=!0,c=".md"),a+=c,c===".md"?a=this._get_markdown_export_options(a):a=this._get_typical_export_options(a),this.options.task_ids&&this.options.task_ids.length>0&&(a+="&task_ids="+this.options.task_ids.join(",")),a},_run_export:function(){$("exportForm").down(".exportedContent__progress").show(),$("exportedText").innerHTML="",maxkir.form_state("exportForm").save_state();var a=this._build_url();console.info("Export URL "+a);var b=document.activeElement;return new maxkir.AjaxRequest(a,{method:"get",onSuccess:function(c){if(a!==this._build_url())return;var d=c.responseText;this._rtf&&(d=maxkir.CommonRender.format_for_rendering(d,!0)),this._prepare_output_element();var e=$("exportedText");e.innerHTML=d,maxkir.set_selection(e,0,d.length),e.scrollTop=0,$("exportForm").down(".exportedContent__progress").hide(),this._update_options_view(),b&&b.focus()}.bind(this)}),!1},_prepare_output_element:function(){var a=$("exportedText"),b=document.createElement(this._rtf?"div":"xmp");b.id="exportedText",b.setAttribute("contenteditable","true"),b.setAttribute("class","userContent"),a.parentNode.replaceChild(b,a)},_get_typical_export_options:function(a){return a+=a.match(/\?/)?a.match(/&$/)?"":"&":"?",$("export_status").checked&&(a+="export_status=true&"),$("export_notes").checked&&(a+="export_notes=true&"),$("export_details").checked&&(a+="export_details=true&"),$("export_color").checked&&(a+="export_color=true&"),a},_get_markdown_export_options:function(a){return a+="?",$("generateHeadings").checked&&($("max_heading").value>=0&&(a+="&max_heading="+$("max_heading").value),$("headers_with_subitems_only").checked&&(a+="&headers_with_subitems_only=true"),$("keep_explicit_headings_on_conflict").checked&&(a+="&keep_explicit_headings_on_conflict=true")),$("export_notes_md").checked&&(a+="&export_notes_md=true"),$("export_uploads").checked&&(a+="&export_uploads=true"),a}}),maxkir.ui.ImportPopup=maxkir.ui.create_popup(!1,{popup_width:480,refresh:function(){var a=this.win;this.popupContent||(this.popupContent=$("importPopup").innerHTML,$("importPopup").innerHTML=""),a.getContent().update(this.popupContent),setTimeout(function(){$("import_content").activate()},50)},onShow:function(){maxkir.form_state("importForm").restore_state(),this.scrollToShow()},submit_form:function(a){maxkir.form_state("importForm").save_state();if($F("import_content").blank()){new 
maxkir.ui.Message("You haven't provided any data to import");return}$("parent_id").value=this.options.task_id;var b=$("importButton");return b.value=I18N("button_progress"),b.disable(),$("import_error").innerHTML="",new maxkir.AjaxCommand(a.action,{evalScripts:!0,parameters:Form.serialize(a),onComplete:function(){$("import_error").innerHTML.blank()?this.win.close():(b.enable(),b.value=I18N("import.import_button"),this.win.updateHeight(),$("import_content").activate())}.bind(this)}),!1}}),maxkir.HighlightElements={_highlighted:[],notice:function(){return $("highligtingNotice")},highlight:function(){this.notice()&&this.notice().show(),this._highlighted.each(function(a){$(a)&&$(a).addClassName("highlightEl")})},getHighlighted:function(){return this._highlighted||[]},sameHighlighted:function(a){if(!a)return!1;var b=this;return a.length==this._highlighted.length&&a.every(function(a,c){return a===b._highlighted[c]})},removeHighlighting:function(a){this.notice()&&this.notice().hide(),this._highlighted.each(function(a){$(a)&&$(a).removeClassName("highlightEl")}),this._highlighted=[],a&&Element.remove(a)},addHighlighting:function(a){this._highlighted.push(a)}},maxkir.Notifications={_highlighted:[],enable:function(){maxkir.Notifications._enabled=!0},enabled:function(){return this._enabled},sendFor:function(a){var b=$("notificationButton");return b&&(b.disable(),b.value="Notifying ..."),new maxkir.AjaxCommand("/checklists/"+a+"/notify",{method:"post",parameters:Form.serialize(document.notifyForm),onSuccess:function(){new maxkir.ui.Message("Notification about your changes has been sent"),maxkir.NotifyPopup.hide_popup()},onFailure:function(){new maxkir.ui.Message("Sorry, unable to send notification<br/> Please try again later")},onComplete:function(){maxkir.checklist.refresh_topbar(),b&&(b.value="Notify")}}),!1},add_task_highligting:function(a){maxkir.HighlightElements.addHighlighting("core_"+a);var b=maxkir.tree_model.getParent("task_"+a);b&&maxkir.ChecklistNodeToggle.expand(maxkir.Task.id(b))},toggle_subscribe:function(a,b,c){a=$(a);var d=!a.checked;maxkir.Notifications.update_title(a,d,c),new maxkir.AjaxCommand("/checklists/"+b+"/notifications",{method:d?"delete":"post",parameters:"what="+c,onSuccess:function(){maxkir.Notifications.update_table_row(a),maxkir.Notifications.update_notifications_icon()}})},update_table_row:function(a){var b=a.up("tr");b&&(b.removeClassName("selected"),b.getElementsBySelector("input").each(function(a){a.checked&&b.addClassName("selected")}))},update_notifications_icon:function(a){var b=!!a;typeof a=="undefined"&&(b=$("dailyDigest").checked||$("ongoing").checked||$("dueDigest").checked);var c=this.topbar_icon();if(c){var d=$(c).down("i");d.removeClassName("fas"),d.removeClassName("fal"),d.addClassName(b?"fas":"fal")}},update_title:function(a,b,c){b?a.title=a.title.replace("Unsubscribe","Subscribe to "+c):a.title=a.title.replace("Subscribe to "+c,"Unsubscribe")},toggle_disable:function(a,b){a=$(a);var c=a.innerHTML=="resume";c?(a.innerHTML="pause",a.title="Disable all notifications for "+b):(a.innerHTML="resume",a.title="Enable notifications for "+b),new maxkir.AjaxCommand("/checklists/none/notifications",{method:c?"delete":"post",parameters:"what="+b,onSuccess:function(){var a=c?"You've enabled "+b+" notifications":"You've disabled "+b+" notifications";new maxkir.ui.Message(a),maxkir.Notifications.toggle_disabled_status(b=="ongoing"?1:b=="digest"?2:3)}})},toggle_disabled_status:function(a){$$("table.notificationTable tr").each(function(b){$(b).down("td",a)&&$(b).down("td",a).toggleClassName("disabled")}),maxkir.Notifications.update_checkboxes()},update_checkboxes:function(){$$("table.notificationTable input").invoke("enable"),$$("table.notificationTable td.disabled input").invoke("disable")},topbar_icon:function(){return document.querySelector(".topbar__notifications")},init_topbar_control:function(a){var b=this.topbar_icon();if(!b){var c=document.querySelector(".topbar_afterNav"),d='<a class="topbar__navLink topbar__navIcon topbar__notifications" href="#"           title="'+I18N("js_notifications_title")+'"           onclick="maxkir.NotifyPopup.toggle_popup(this, maxkir.checklist_id, true); return false;"           ><i class="far fa-bell"></i></a>';c.insertAdjacentHTML("afterend",d)}this.update_notifications_icon(a)}},maxkir.NotifyPopup=maxkir.ui.create_popup(!1,{popup_width:450,refresh:function(){this.win&&this.win.setAjaxContent("/checklists/"+this.checklist_id+"/notify",{evalScripts:!0,method:"get",onComplete:this.on_load.bind(this)},!1)},on_load:function(){if(!maxkir.Notifications.enabled()){var a=$("disabledNotification");a&&(a.show(),a.next().hide())}var b=this.win,c=function(){b.updateHeight(),setTimeout(function(){b.updateHeight()},400)},d=new maxkir.ui.Accordion(b.getContent(),{onChange:function(a,b){c()}});maxkir.run_before(b,"close",function(){d.dispose()})},select_all:function(a){var b=document.forms.notifyForm.elements;for(var c=0;c<b.length;c++){var d=b[c];d.type=="checkbox"&&(d.checked=a)}return!1}}),maxkir.checklist=maxkir.checklist||{},maxkir.checklist.installKeyboard=function(){if(this._installed)return;this._installed=!0;var a={};a.no_popups=function(){return!maxkir.cmd.popup_visible()},a.no_popup_but_actions=function(){return a.no_popups()||maxkir.cmd.is_popup("actionsPopupData")},a.no_focused_filter=function(){return!maxkir.cmd.has_focused_filter()},a.no_editing=function(){return!maxkir.EditTracker.is_editing()},a.no_active_textfield=function(){return!maxkir.is_focused_textfield()},maxkir.kbd.addShortcut("ctrl+enter|meta+enter",function(b){if(a.no_popup_but_actions())return;var c=Event.element(b).tagName;if(c==="INPUT"||c==="TEXTAREA"){var d=Event.element(b).form;d&&((!d.onsubmit||d.onsubmit())&&d.submit(),Event.stop(b))}},!0),a.no_popup_but_color_or_actions=function(){return a.no_popup_but_actions()||maxkir.cmd.can_run(!0,!0)};var b=maxkir.kbd.forCondition(a.no_popup_but_actions,"no popup but actions"),c=maxkir.kbd.forCondition(a.no_popups,"no popups");c.addShortcut("esc",function(a){maxkir.CommandProcessor.queue.length>0&&!maxkir.EditTracker.is_editing()&&Event.stop(a)},!0).addShortcut("tab|shift+tab",function(a){var b=function(){this._interval&&(clearInterval(this._interval),delete this._interval)}.bind(this);maxkir.add_task.is_adding()&&!maxkir.cmd.task_id()&&(b(),this._interval=setInterval(function(){if(maxkir.add_task.is_adding()){if(maxkir.cmd.task_id()){b();var c=maxkir.cmd[a.shiftKey?"move_left":"move_right"];c&&c()}}else b()}.bind(this),250),Event.stop(a))},!0);var d=c.forCondition(maxkir.add_task.is_adding,"is adding a task");d.addShortcut("up|down|delete|enter",function(a){var b=$("task_content").value;b.blank()&&(maxkir.add_task.hide_add(),Event.stop(a))},!0),d.forCondition(maxkir.cmd.task_id,"task_id when adding").addShortcut("tab",function(a,b){maxkir.cmd.move_right()}).addShortcut("shift+tab",function(a,b){maxkir.cmd.move_left()});var e=b.forCondition(a.no_editing,"no editing").forCondition(a.no_focused_filter,"no focused filter");e.addShortcut("u u|ctrl+z|meta+z|u n d o",function(){maxkir.cmd.undo()}).addShortcut("ctrl+c|meta+c",function(){maxkir.newCopyPaste||maxkir.CopyPaste.copymove("copy")},!0).addShortcut("ctrl+x|meta+x",function(){maxkir.newCopyPaste||maxkir.CopyPaste.copymove("move")},!0).addShortcut("ctrl+v|meta+v",function(){maxkir.newCopyPaste||maxkir.CopyPaste.paste()},!0).addShortcut("ctrl+d|meta+d",function(a){maxkir.CopyPaste.duplicate(),Event.stop(a)},!1).addShortcut("alt+enter",function(a){maxkir.cmd.add_task(!0)&&Event.stop(a)},!0).addShortcut("shift+right",function(a){maxkir.cmd.toggle_focus()&&Event.stop(a)},!0).addShortcut("shift+left",function(a){maxkir.TaskFocus.remove_focus(!0,!0)}).addShortcut("l a",function(a){maxkir.cmd.list_actions()}).addShortcut("r e s e t",function(a){maxkir.cmd.reset()}).addShortcut("w i p e",function(a){maxkir.cmd.wipe_closed()}).addShortcut("r d",function(a){maxkir.cmd.view_deleted()}).addShortcut("w c",function(){maxkir.cmd.word_count()}).addShortcut("p c",function(){maxkir.cmd.toggle_progress_counter()}).addShortcut("a a",function(){maxkir.cmd.view_actions()},!0).addShortcut("i m",function(){maxkir.cmd.import_items()},!0).addShortcut("e x",function(){maxkir.cmd.export_items()},!0).addShortcut("e c",function(){maxkir.cmd.view_expand_collapse()},!0).addShortcut("m m",function(){maxkir.cmd.move_to_another_list()}).addShortcut("x x",function(){maxkir.cmd.extract_checklist()}).addShortcut("shift+enter",function(){maxkir.cmd.add_subtask()}).addShortcut("esc",function(a){if(maxkir.Undo&&maxkir.Undo.hide_undo()){Event.stop(a);return}var b=maxkir.cmd.task_id_from_child()||maxkir.cmd.task_id();!maxkir.notes(b).hide_notes()&&!maxkir.cmd.reset_filter()&&(maxkir.tree_nav.hide_selection(),maxkir.tree_nav.unfreeze_selection()),Event.stop(a)},!0);var f=e.forCondition(maxkir.cmd.task_id,"has task_id"),g=f.forCondition(a.no_popups,"no popups");g.addShortcut("insert",function(a,b){if(maxkir.read_only)return;maxkir.add_task.show_add(b,0)}).addShortcut("ctrl+left|shift+tab",function(){maxkir.cmd.move_left()}).addShortcut("ctrl+right|tab",function(){maxkir.cmd.move_right()}).addShortcut("ctrl+up|meta+up|ctrl+k",function(){maxkir.cmd.move_up_jump()}).addShortcut("ctrl+alt+up|meta+alt+up|alt+shift+up",function(){maxkir.cmd.move_up_crawl()}).addShortcut("ctrl+down|meta+down|ctrl+j",function(){maxkir.cmd.move_down_jump()}).addShortcut("ctrl+alt+down|meta+alt+down|alt+shift+down",function(){maxkir.cmd.move_down_crawl()}).addShortcut("ctrl+home|meta+home",function(){localStorage.getItem("cv.disable.ctrlHome")||maxkir.cmd.move_home()}).addShortcut("meta+pageup|alt+pageup",function(){maxkir.cmd.move_top()}).addShortcut("meta+pagedown|alt+pagedown",function(){maxkir.cmd.move_bottom()}).addShortcut("ctrl+end|meta+end",function(){localStorage.getItem("cv.disable.ctrlHome")||maxkir.cmd.move_end()});var h=maxkir.kbd.forCondition(a.no_popup_but_color_or_actions,"color no_popup_but_color_or_actions").forCondition(a.no_active_textfield,"color no_active_textfield").forCondition(a.no_focused_filter,"color no_focused_filter").forCondition(maxkir.cmd.task_id,"color task_id");maxkir.TreeTaskColorsInstall(h),maxkir.TreeTaskCommandsInstall(e);var i=e.forCondition(a.no_popups,"no popups");maxkir.TreeKbdNavigationInstall(i,maxkir.tree_nav,maxkir.ChecklistNodeToggle)},maxkir.cmd.key_left=function(a,b,c){if(maxkir.cmd.task_child_id("upload")){b.key_up(a);return}if(maxkir.cmd.task_child_id("note")){b.key_left(a);return}var d=maxkir.Task.id(a),e=maxkir.notes(d);if(e.hide_notes())return;c.isCollapsed("task_"+d)||!maxkir.Task.renderer(d).hasSubtasks()?b.key_left(a):c.collapseNode("task_"+d)},maxkir.cmd.key_right=function(a,b,c){var d=maxkir.Task.id(a);!c.isCollapsed("task_"+d)||!maxkir.Task.renderer(d).hasSubtasks()?maxkir.notes(d).show_existing()||b.key_down(a):c.expandNode("task_"+d)},maxkir.update_timezone=function(){if(maxkir.temporary||maxkir.get_flag("cl_tz_updated"))return;maxkir.set_flag("cl_tz_updated","true",43200),new maxkir.AjaxRequest("/auth/profile.js",{parameters:"no_auth=true&user[tz_offset_min]="+maxkir.tz_offset_min(),method:"post"})},Event.observe(window,"load",maxkir.update_timezone),maxkir.TreeDropSupport=function(a,b){this.tree=$(a);if(!this.tree){maxkir.error("Unable to install DND for "+a);return}this.options={handleDrop:function(a,b){},handleOver:function(a,b){},handleOut:function(a,b){}},Object.extend(this.options,b||{}),this.installDndHandlers(),this.boundDispose=this.dispose.bind(this),Event.observe(window,"unload",this.boundDispose),maxkir.TreeDropSupport._globalHandlers||(maxkir.TreeDropSupport._globalHandlers=!0,Event.observe(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",Event.stop(a))}))},Object.extend(maxkir.TreeDropSupport.prototype,{installDndHandlers:function(){this.tree.observe("dragenter",this.onDragOver.bind(this)),this.tree.observe("dragover",this.onDragOver.bind(this)),this.tree.observe("dragleave",this.onDragLeave.bind(this)),this.tree.observe("drop",this.onDrop.bind(this))},dispose:function(){this.tree.stopObserving("dragenter"),this.tree.stopObserving("dragover"),this.tree.stopObserving("dragleave"),this.tree.stopObserving("drop"),Event.stopObserving(window,"unload",this.boundDispose),delete this.tree},onDragOver:function(a){var b=Event.element(a);b.tagName!="LI"&&(b=b.up("li")),this.handleOut(a),b&&(this.target_element=b,this.options.handleOver(a,b)),Event.stop(a)},onDragLeave:function(a){this.handleOut(a)},onDrop:function(a){return this.target_element&&this.options.handleDrop(a,this.target_element),Event.stop(a),!1},handleOut:function(a){this.target_element&&(this.options.handleOut(a,this.target_element),this.target_element=null)},_f:null}),maxkir.TaskFocus={focus_stack:[],_listeners:new maxkir.Listeners,add_listener:function(a){a.__cv_focus={change:a},this._listeners.add_listener(a.__cv_focus)},remove_listener:function(a){this._listeners.remove_listener(a.__cv_focus)},toggle_focus:function(a){if(!maxkir.FindFilter)return!1;maxkir.info("Toggle focus: "+a),this.current_task_id==a?this.remove_focus(!0,!0):this.add_focus(a)},set_focus:function(a){this.remove_focus(),this.toggle_focus(a)},focusedTaskId:function(){return this.is_active()?this.current_task_id:""},is_active:function(){return!!this.current_filter},shouldAddFocusActiveUL:function(a){return this.is_active()?a.tasks&&!this.parents_shown&&a.tasks.indexOf(this.current_task_id)>-1:!1},remove_focus:function(a,b){if(!maxkir.FindFilter)return null;var c;return b&&this.focus_stack.length>1?(c=this.focus_stack.shift(),this._set_focus_to(),c):(this.focus_stack=[],maxkir.FilterState.updateFocusedTask(null),window.history&&window.history.replaceState(undefined,undefined,"#"),this.is_active()?(maxkir.info("Remove focus: "+this.focusedTaskId()),maxkir.FindFilter.remove_filter(this.current_filter),this.current_filter=null,c=this.current_task_id,this.current_task_id=null,this._listeners.notify_listener("change",c,null),this.was_collapsed&&maxkir.ChecklistNodeToggle.collapse(c),a&&this.refilter(),c):null)},refilter:function(){maxkir.FindFilter.refresh_filter(),maxkir.tree_nav.fix_scrolling&&maxkir.tree_nav.fix_scrolling_big()},add_focus:function(a){if(!maxkir.FindFilter)return;if(!a||this.current_task_id==a)return;this.focus_stack.unshift(parseInt(a)),this._set_focus_to()},_set_focus_to:function(){var a=this.focus_stack[0],b=this.current_task_id||null;this.current_task_id=a||null,window.history&&window.history.replaceState(undefined,undefined,"#task_"+a);var c=maxkir.Task.data(a);this.was_collapsed=!1,c&&(this.was_collapsed=c.collapsed,this.was_collapsed&&maxkir.ChecklistNodeToggle.expand(a)),this.current_filter&&maxkir.FindFilter.remove_filter(this.current_filter),this.current_filter={accept_item:function(b){return b.id==a?"focus":null},get_active:function(){return!0}},maxkir.FindFilter.add_filter(this.current_filter),maxkir.FilterState.updateFocusedTask(a),this._listeners.notify_listener("change",b,this.current_task_id),this.refilter()}},maxkir.Breadcrumbs={HIDE_PARENTS_KEY:"hideFocusBreadcrumbs",show_parents:function(){var a=document.querySelector(".focusBreadcrumbs");a&&(a.classList.remove("focusBreadcrumbs--hideParents"),localStorage.removeItem(this.HIDE_PARENTS_KEY)),this.parents_shown=!0,maxkir.FilterState.updateFocusedTask(maxkir.TaskFocus.focusedTaskId(),!0)},hide_parents:function(){maxkir.FilterState.updateFocusedTask(maxkir.TaskFocus.focusedTaskId(),!1),this._update_indicator_view(),this.changeTreeRoot(maxkir.TaskFocus.focusedTaskId());var a=document.querySelector(".focusBreadcrumbs");a&&(a.classList.add("focusBreadcrumbs--hideParents"),localStorage.setItem(this.HIDE_PARENTS_KEY,"true")),this.parents_shown=!1},_update_indicator_view:function(){maxkir.TaskFocus.is_active()&&this.update_focus_view(maxkir.TaskFocus.focusedTaskId(),!0)},set_focus:function(a){maxkir.TaskFocus.set_focus(a),maxkir.tree_nav.set_selection("task_"+a)},initialize:function(){var a=this;maxkir.TaskFocus.add_listener(function(b,c){b&&(a.update_focus_view(b,!1),a.restore_tree_root()),c&&a.show_breadcrumbs_for(c)})},show_breadcrumbs_for:function(a){var b=maxkir.Task.data(a);this.update_icon(!!b),this.update_focus_view(a,!!b),this.changeTreeRoot(a),this._update_keyboard_navigation(),this._update_breadcrumbs(a)},update_icon:function(a){var b=$("focusBreadcrumbs");b&&a&&b.removeClassName("compactOff")},update_focus_view:function(a,b){var c=b?"addClassName":"removeClassName";$("h1Id")&&$("h1Id")[c]("list-h1_focusActive");var d="focusActive",e=document.querySelector(".focusBreadcrumbs");e&&(b?(e.show(),localStorage.getItem(this.HIDE_PARENTS_KEY)?(e.classList.add("focusBreadcrumbs--hideParents"),this.parents_shown=!1):(e.classList.remove("focusBreadcrumbs--hideParents"),this.parents_shown=!0)):e.hide());var f=this.task_element(a);if(f){var g=f.up("ul.dndUl");g&&(g[c](d),f.up("ul.topLevel")[c](d)),f.up("ul.topLevel")[c]("focusActiveTop")}},task_element:function(a){return $("task_"+a)},changeTreeRoot:function(a){this.restore_tree_root();if(a){this.old_tree_root=maxkir.tree_model.getRoot();var b=maxkir.tree_model.getParent("task_"+a);b&&(b.startsWith("task_")&&(b="parentTask_"+maxkir.Task.id_str(b)),maxkir.tree_model.setRoot(b))}},restore_tree_root:function(){this.old_tree_root&&(maxkir.tree_model.setRoot(this.old_tree_root),this.old_tree_root=null)},_update_keyboard_navigation:function(){var a=document.querySelector(".focusBreadcrumbs");if(!a)return;if(a.keybardUpdated)return;a.keybardUpdated=!0;var b=!1;a.on("focus","a",function(){b||a.blur(),b=!1});var c=-1,d=function(){if(!maxkir.visible(a)||a.getStyle("opacity")==0)return[];var b=a.querySelectorAll("a"),c=[];for(var d=0;d<b.length;d++)maxkir.visible(b[d])&&$(b[d]).getStyle("visibility")!=="hidden"&&c.push(b[d]);return c},e=function(){var a=d();if(!a.length)return;c>=a.length-1?(c=-1,maxkir.tree_nav.selectFirstInTree()):a[++c].focus()},f=function(){var a=d();if(!a.length)return;maxkir.tree_nav.set_selection(null);if(c===0){a[0].focus();return}c<0&&(c=a.length),a[--c].focus()};a.on("keydown","a",function(c){if(maxkir.visible(a)){b=!0;switch(c.keyCode){case Event.KEY_DOWN:case Event.KEY_RIGHT:c.target.blur(),e(),Event.stop(c);return;case Event.KEY_UP:case Event.KEY_LEFT:c.target.blur(),f(),Event.stop(c);return;case Event.KEY_RETURN:case 32:c.target.click(),Event.stop(c);return}}});var g=function(d){var e=maxkir.tree_nav[d];maxkir.tree_nav[d]=function(d){if(maxkir.visible(a)&&(maxkir.tree_nav.is_first_node(d)||!d))b=!0,c=-1,f();else return e.call(maxkir.tree_nav,d)}};g("key_up"),g("key_left")},_update_breadcrumbs:function(a){var b=[],c=maxkir.Task.data(a),d;while(c&&b.indexOf(c)===-1)b.unshift(c),d=c.checklist_id,c=maxkir.Task.data(c.parent_id);var e="";if(b.length){var f=maxkir.Lists.data(d);if(f){var g=f.name;e+="<a class=focusBreadcrumbs__item href='/checklists/"+d+"' onclick='maxkir.TaskFocus.remove_focus(true); maxkir.tree_nav.selectFirstInTree(); return false;'>"+maxkir.CommonRender.format_for_breadcrumbs(g)+"</a>"}b.splice(b.length-1),b.forEach(function(a){e+="<i class='far fa-angle-right focusBreadcrumbs__separator'></i>";var b="/checklists/"+a.checklist_id+"/tasks/"+a.id,c=maxkir.CommonRender.format_for_breadcrumbs(a.content);e+="<a class=focusBreadcrumbs__item href='"+b+"' onclick='maxkir.Breadcrumbs.set_focus("+a.id+"); return false;' title='"+c+"'>"+c+"</a>"})}var h=document.querySelector(".focusBreadcrumbs");if(h){var i=h.querySelectorAll("*");for(var j=0;j<i.length;j++)i[j].id!=="focusBreadcrumbs"&&i[j].parentNode.removeChild(i[j]);h.insertAdjacentHTML("beforeend",e)}}},maxkir.Breadcrumbs.initialize(),maxkir.Refresher=function(a,b,c,d){this.value=a,this.url=b,this.reload_function=c,this.paused_function=d,this.refresh_needed=!1,this.start()},maxkir.Refresher.install=function(a,b,c){maxkir.refresher=new maxkir.Refresher(a,b,c,function(){return maxkir.EditTracker.is_editing()||!maxkir.CommandProcessor.is_empty()})},maxkir.extend(maxkir.Refresher,{start:function(){this.intervalHandle=setInterval(this.check_for_update.bind(this),1e3),this.secs_between=10,this.update_now()},stop:function(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=null)},set_value:function(a){this.value!=a&&(maxkir.info("rv changed: "+this.value+" => "+a),this.value=a)},mark_for_refresh:function(){this._paused()?this.refresh_needed=!0:this._doReload()},reset_refresh:function(){this.refresh_needed=!1},append_curr_timestamp:function(a){a.parameters||(a.parameters=""),a.parameters.replace?(a.parameters=a.parameters.replace(/&?rv=\d+/,""),a.parameters===""?a.parameters=this.add_on():a.parameters+="&"+this.add_on()):a.parameters.rv=this.value},add_on:function(){return this.value&&this.value>0?"rv="+this.value:""},check_for_update:function(){if(this.refresh_needed&&this._paused())return;if(this.refresh_needed){this._doReload();return}this.inc_counter||(this.inc_counter=0),this.inc_counter++;if(this.inc_counter<this.secs_between)return;this.inc_counter=0,this.update_now()},update_now:function(){this.ping_server(function(a){a>this.value&&(maxkir.info("External change detected: "+a+" > "+this.value),this.mark_for_refresh())})},ping_server:function(a){if(this._paused())return;new maxkir.AjaxRequest(this.url,{method:"get",onComplete:function(a){a.status||this._onFailedRequest()}.bind(this),onFailure:function(){this._onFailedRequest()}.bind(this),onSuccess:function(b){try{this._failed_secs_between&&(maxkir.info("Connection restored!"),this.secs_between=this._failed_secs_between,this._failed_secs_between=0);var c=parseInt(b.responseText);if(b.responseText[0]=="{"){var d=b.responseText.evalJSON();c=d.rv;if(this.progress_callback)try{if(!this.progress_callback.call(this,d.progress)){this.unset_progress_mode(),this.set_value(c);return}}catch(e){maxkir.exception(e),this.unset_progress_mode()}}a&&a.call(this,c),this.set_value(c)}catch(e){maxkir.exception(e)}}.bind(this)})},_onFailedRequest:function(){this._failed_secs_between||(this._failed_secs_between=this.secs_between),this.secs_between<300&&(this.secs_between=this.secs_between*2),maxkir.info("Failed request, set query interval to "+this.secs_between+" seconds")},start_progress_mode:function(a,b){this.progress_callback=b,this.old_url=this.url,this.url=this.url+".json?progress="+a,this.old_secs=this.secs_between,this.secs_between=2},unset_progress_mode:function(){this.progress_callback=null,this.url=this.old_url,this.secs_between=this.old_secs},_doReload:function(){this.reset_refresh(),this.reload_function()},_paused:function(){return this.paused_function&&this.paused_function()}}),maxkir.install_tap_and_hold=function(a,b){var c,d,e,f,g=function(){e&&(clearTimeout(e),e=null),f=!1},h=document.body.on("touchstart",a,function(a,h){f=!1;if(a.touches&&a.touches.length==1){var i=$(a.touches[0].target);if(i.hasClassName("userContent")||i.up(".userContent"))c=a.touches[0].pageX,d=a.touches[0].pageY,e=setTimeout(function(){b.call(h,h),f=!0},400)}else g()}),i=document.body.on("touchmove",function(a){a.touches&&a.touches.length==1&&(e&&Math.abs(d-a.touches[0].pageY)>10||Math.abs(c-a.touches[0].pageX)>10)&&g()}),j=document.body.on("touchend",function(a){f&&Event.stop(a),g()});return{stop:function(){h.stop(),j.stop(),i.stop()}}},maxkir.install_double_tap=function(a,b){var c,d,e,f=function(){c=0,d=null,e&&(clearTimeout(e),e=null)};return document.body.on("touchend",a,function(a,g){if(a.touches.length>0){f();return}var h=(new Date).getTime();h-c<300?(f(),b.call(g,g,a)):(c=h,d=g,e=setTimeout(f,350))})},maxkir.IntroductoryMode={_all_steps:[],_intro_steps:[],add_default_intro_step:function(a,b){var c=new maxkir.IntroDefaultPopup(a,b);this._intro_steps.push(c),this.add_step(c)},add_step:function(a){this._all_steps.push(a)},start_introductory:function(){this._active=null,this._build_steps(),this._interval=setInterval(this.process_current_step.bind(this),1e3),this._last_type_timestamp=(new Date).getTime(),document.addEventListener("keydown",function(){this._last_type_timestamp=(new Date).getTime()}.bind(this))},stop_introductory:function(){this.deactivate_step(),this.forced_step_id=null,localStorage.getItem(this._done_key())||(maxkir.Sidebar.show(),localStorage.setItem(this._done_key(),"true")),maxkir.tree_nav&&maxkir.tree_nav.fix_selection()},can_activate_default_step:function(){var a=localStorage.getItem(this._done_key());return!a&&maxkir.user.is_recent_user()},can_activate_hint:function(){return(new Date).getTime()-this._last_type_timestamp>1e3&&!window.curr_message},_build_steps:function(){var a=this;if(!maxkir.read_only){var b=$$(".js-introductoryPopup");b.forEach(function(c,d){a.add_default_intro_step(c.id,d+1===b.length)})}},force_show:function(){this.forced_step_id||(this.forced_step_id=sessionStorage.getItem("last_intro_popup")||this._intro_steps[0].id,this.process_current_step())},action_count:function(){return maxkir.stats.value("ajax")},process_current_step:function(){if(maxkir.checklist.name_editor&&maxkir.checklist.name_editor.isEditing()||maxkir.ui.Popups.hasDialog())return;if(this.forced_step_id){var a=this._all_steps.find(function(a){return a.id===this.forced_step_id},this);a&&(maxkir.debug("Force activate "+a.id),this.activate_step(a));return}this._active&&this._active.should_passivate(this)&&this.deactivate_step();if(!this._active){var b=this;this._all_steps.forEach(function(a){a.should_activate(b).then(function(c){if(c&&!b._active&&b.can_activate_hint()){if(b._is_intro_step(a)&&!b.can_activate_default_step())return;b.activate_step(a)}})})}},_is_intro_step:function(a){return this._intro_steps.indexOf(a)>=0},_done_key:function(){return"introductory_done_"+maxkir.current_user_id},activate_step:function(a){if(this._active&&this._active.id===a.id)return;this.deactivate_step(),maxkir.debug("Activate introductory step "+a.id),this._active=a,this._active.activate(this)},deactivate_step:function(a){if(this._active){this._is_intro_step(this._active)&&sessionStorage.setItem("last_intro_popup",this._active.id);var b=this._active;this._active=null,b.passivate(a)}},create_and_show_popup:function(a,b,c,d){c=c||{},maxkir.info("Show help popup "+b);var e=450,f=new maxkir.ui.Popup($$(a)[0],e,Object.extend({removeOtherPopups:!1,floating:!0,anchor:"left",className:"leftArrowBlue cl2",y_shift:0,x_shift:0},c));f.setHTMLContent("<div class='introductionPopup "+(c.extraCssClass||"")+"'>"+"<a title='"+I18N("intro_close_popup")+"' class='closePopup'><i class='far fa-times-circle'></i></a>"+d+"</div>"),Element.setOpacity(f.element,0),f.show(),maxkir.animate(300,function(a){Element.setOpacity(f.element,a)});if(c.arrow_top_shift){var g=f.getContent().down(".leftHandle");g?(g.style.top=c.arrow_top_shift+"px",maxkir.addClassName(g,"handlePulseArrowLeft")):maxkir.info("Cannot find arrowHandle")}var h=f.getContent().down(".closePopup");return h.on("mousedown",function(a){c.default_step?this.stop_introductory():this.deactivate_step(!0)}.bind(this)),f.addDisposerOnClose(function(){h.stopObserving(),this.deactivate_step(!0)}.bind(this)),f},show_popup:function(a,b,c){var d=this.create_and_show_popup(a,b,c,$(b).innerHTML),e=d.getContent().down(".nextPopup");e&&e.on("mousedown",function(){this.forced_step_id=this._intro_steps[this._intro_steps.indexOf(this._active)+1].id,this.process_current_step()}.bind(this));var f=d.getContent().down(".previousPopup");return f&&f.on("mousedown",function(){this.forced_step_id=this._intro_steps[this._intro_steps.indexOf(this._active)-1].id,this.process_current_step()}.bind(this)),d.addDisposerOnClose(function(){e&&e.stopObserving(),f&&f.stopObserving(),d.closed_with_esc&&this.stop_introductory()}.bind(this)),d}},maxkir.IntroSimplePopup=function(a){this.id=a},maxkir.extend(maxkir.IntroSimplePopup,{activate:function(a){this.win=maxkir.IntroductoryMode.show_popup("#h1Id",this.id,this.popup_options)},popup_options:{x_shift:450,y_shift:50,default_step:!0},passivate:function(a){a&&localStorage.setItem(this._step_seen_key(),!0);if(this.win&&this.win.isVisible()){var b=this.win;this.win=null,b.close()}},_step_seen_key:function(){return this.id+"_"+maxkir.current_user_id},should_activate:function(a){return Promise.resolve(!localStorage.getItem(this._step_seen_key()))},should_passivate:function(a){return!1}}),maxkir.IntroDefaultPopup=function(a,b){maxkir.IntroSimplePopup.call(this,a),this.last_default_step=b},maxkir.extend(maxkir.IntroDefaultPopup,{activate:function(a){this._nav_count=a.action_count(),maxkir.IntroSimplePopup.prototype.activate.call(this)},passivate:function(a){localStorage.setItem(this._step_seen_key(),!0),maxkir.IntroSimplePopup.prototype.passivate.call(this,a)},should_passivate:function(a){return this.last_default_step?!1:a.action_count()-this._nav_count>=2}},maxkir.IntroSimplePopup),maxkir.IntroShare=function(){maxkir.IntroSimplePopup.call(this,"hint_share")},maxkir.extend(maxkir.IntroShare,{activate:function(a){this.win=a.create_and_show_popup(".sharreLink","shareHint",{className:"topArrowBlue cl2",y_shift:3,width:"auto",extraCssClass:"introductionPopup--compact"},this._content)},should_activate:function(a){var b=this;return maxkir.IntroSimplePopup.prototype.should_activate.call(this).then(function(a){return a&&!b._promise_check&&(b._promise_check=new Promise(function(a,c){maxkir.AjaxRequest("/hints/share.json",{method:"get",onSuccess:function(c){b._content=c.responseJSON.show?$(c.responseJSON.contentId).innerHTML:"",a(c.responseJSON.show)},onComplete:function(){c()}})})),a?b._promise_check:a})}},maxkir.IntroSimplePopup),maxkir.ZenMode={toggle:function(){var a=document.querySelector(".zenBgImage");a||(a=document.createElement("div"),a.classList.add("zenBgImage"),document.body.insertBefore(a,document.body.firstChild),maxkir.FindFilter.add_listener({focus_changed:function(a){a?$("ffContainer").addClassName("ffContainer--focused"):$("ffContainer").removeClassName("ffContainer--focused")}})),setTimeout(function(){document.body.classList.toggle("zenMode"),this.saveState(),$("zen_mode")&&($("zen_mode").checked=this.enabled(),this._hide_breadcrumbs_if_needed(),this.enabled()&&!maxkir.get_flag("zen")&&(maxkir.set_flag("zen",!0,7776e3),new maxkir.ui.Message(I18N("js_zen_mode_active"))))}.bind(this),10)},_hide_breadcrumbs_if_needed:function(){this.enabled()&&maxkir.Breadcrumbs&&maxkir.TaskFocus.is_active()&&maxkir.Breadcrumbs.hide_parents()},enabled:function(){return document.body.classList.contains("zenMode")},saveState:function(){sessionStorage.setItem("zen",this.enabled().toString())},restoreState:function(){var a=sessionStorage.getItem("zen")==="true";a&&this.toggle()}},maxkir.onDom(function(){if(!maxkir.TaskFocus)return;maxkir.TaskFocus.add_listener(function(a,b){a||maxkir.ZenMode._hide_breadcrumbs_if_needed()})})