function maxkir_submit_register(){maxkir.get_it.submit_register()}maxkir.setup_tz_offset_initializers=function(){$$("form").each(function(a){maxkir.set_time_zone_value(a)})},maxkir.set_time_zone_value=function(a){var b=$(a.elements["user[tz_offset_min]"]);b||(b=$(a.elements.tz_offset_min)),b&&(b.value=maxkir.tz_offset_min())},maxkir.onDom(maxkir.setup_tz_offset_initializers),maxkir.setup_tz_offset_initializers();var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;a=a.sigBytes,this.clamp();if(d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((h|0)-this._minBufferSize,0);b=h*f,e=a.min(4*b,e);if(b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return(new m.HMAC.init(a,c)).finalize(b)}}});var m=c.algo={};return c}(Math);(function(a){function b(a,b,c,d,e,f,g){return a=a+(b&c|~b&d)+e+g,(a<<f|a>>>32-f)+b}function c(a,b,c,d,e,f,g){return a=a+(b&d|c&~d)+e+g,(a<<f|a>>>32-f)+b}function d(a,b,c,d,e,f,g){return a=a+(b^c^d)+e+g,(a<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){return a=a+(c^(b|~d))+e+g,(a<<f|a>>>32-f)+b}for(var f=CryptoJS,g=f.lib,h=g.WordArray,i=g.Hasher,g=f.algo,j=[],k=0;64>k;k++)j[k]=4294967296*a.abs(a.sin(k+1))|0;g=g.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360}var g=this._hash.words,h=a[f+0],i=a[f+1],k=a[f+2],o=a[f+3],q=a[f+4],r=a[f+5],s=a[f+6],t=a[f+7],u=a[f+8],v=a[f+9],w=a[f+10],x=a[f+11],y=a[f+12],z=a[f+13],A=a[f+14],B=a[f+15],C=g[0],D=g[1],E=g[2],F=g[3],C=b(C,D,E,F,h,7,j[0]),F=b(F,C,D,E,i,12,j[1]),E=b(E,F,C,D,k,17,j[2]),D=b(D,E,F,C,o,22,j[3]),C=b(C,D,E,F,q,7,j[4]),F=b(F,C,D,E,r,12,j[5]),E=b(E,F,C,D,s,17,j[6]),D=b(D,E,F,C,t,22,j[7]),C=b(C,D,E,F,u,7,j[8]),F=b(F,C,D,E,v,12,j[9]),E=b(E,F,C,D,w,17,j[10]),D=b(D,E,F,C,x,22,j[11]),C=b(C,D,E,F,y,7,j[12]),F=b(F,C,D,E,z,12,j[13]),E=b(E,F,C,D,A,17,j[14]),D=b(D,E,F,C,B,22,j[15]),C=c(C,D,E,F,i,5,j[16]),F=c(F,C,D,E,s,9,j[17]),E=c(E,F,C,D,x,14,j[18]),D=c(D,E,F,C,h,20,j[19]),C=c(C,D,E,F,r,5,j[20]),F=c(F,C,D,E,w,9,j[21]),E=c(E,F,C,D,B,14,j[22]),D=c(D,E,F,C,q,20,j[23]),C=c(C,D,E,F,v,5,j[24]),F=c(F,C,D,E,A,9,j[25]),E=c(E,F,C,D,o,14,j[26]),D=c(D,E,F,C,u,20,j[27]),C=c(C,D,E,F,z,5,j[28]),F=c(F,C,D,E,k,9,j[29]),E=c(E,F,C,D,t,14,j[30]),D=c(D,E,F,C,y,20,j[31]),C=d(C,D,E,F,r,4,j[32]),F=d(F,C,D,E,u,11,j[33]),E=d(E,F,C,D,x,16,j[34]),D=d(D,E,F,C,A,23,j[35]),C=d(C,D,E,F,i,4,j[36]),F=d(F,C,D,E,q,11,j[37]),E=d(E,F,C,D,t,16,j[38]),D=d(D,E,F,C,w,23,j[39]),C=d(C,D,E,F,z,4,j[40]),F=d(F,C,D,E,h,11,j[41]),E=d(E,F,C,D,o,16,j[42]),D=d(D,E,F,C,s,23,j[43]),C=d(C,D,E,F,v,4,j[44]),F=d(F,C,D,E,y,11,j[45]),E=d(E,F,C,D,B,16,j[46]),D=d(D,E,F,C,k,23,j[47]),C=e(C,D,E,F,h,6,j[48]),F=e(F,C,D,E,t,10,j[49]),E=e(E,F,C,D,A,15,j[50]),D=e(D,E,F,C,r,21,j[51]),C=e(C,D,E,F,y,6,j[52]),F=e(F,C,D,E,o,10,j[53]),E=e(E,F,C,D,w,15,j[54]),D=e(D,E,F,C,i,21,j[55]),C=e(C,D,E,F,u,6,j[56]),F=e(F,C,D,E,B,10,j[57]),E=e(E,F,C,D,s,15,j[58]),D=e(D,E,F,C,z,21,j[59]),C=e(C,D,E,F,q,6,j[60]),F=e(F,C,D,E,x,10,j[61]),E=e(E,F,C,D,k,15,j[62]),D=e(D,E,F,C,v,21,j[63]);g[0]=g[0]+C|0,g[1]=g[1]+D|0,g[2]=g[2]+E|0,g[3]=g[3]+F|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296);c[(e+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,c[(e+64>>>9<<4)+14]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360,b.sigBytes=4*(c.length+1),this._process(),b=this._hash,c=b.words;for(d=0;4>d;d++)e=c[d],c[d]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;return b},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}}),f.MD5=i._createHelper(g),f.HmacMD5=i._createHmacHelper(g)})(Math),maxkir.get_it={create_temp_account:function(a){a&&(a.disabled=!0);if(this._creating_temp)return;this._creating_temp=!0,setTimeout(function(){var a=document.createElement("form");a.style.display="none",document.body.appendChild(a),a.method="POST",a.action="/auth/create_temp_user.html",a.submit()}.bind(this),500)},switch_form:function(a){if(!$("login_mode"))return;a?($("register_mode").hide(),$("login_mode").show(),$("user_email").activate(),this._change_url("/auth/login","Sign In"),$(document.body).addClassName("loginForm"),$(document.body).removeClassName("registerForm")):($("register_mode").show(),$("login_mode").hide(),$("user_email_reg").activate(),this._change_url("/auth/register","Create Account"),$(document.body).removeClassName("loginForm"),$(document.body).addClassName("registerForm"),this.reset_capture())},_change_url:function(a,b){!this.from_index_page&&window.history&&-1==document.location.href.indexOf(a)&&(window.history.replaceState({},b,a),maxkir.set_title(b))},submit_login:function(){if(this.logging_in)return;this.logging_in=!0;var a=$("login_form");this._show_progress($("login_button")),new Ajax.Request(a.action,{parameters:a.serialize(),method:"post",onComplete:function(){this.logging_in=!1,this._hide_progress()}.bind(this)})},submit_register:function(){var a=$("user_form"),b="";$F("user_email_reg")===""&&(b+="Email is not specified<br>"),maxkir.visible("user_username_reg")&&$F("user_username_reg")===""&&(b+="Your screen name is not specified<br>"),this._fix_state(a),maxkir.visible("user_password_reg")&&$F("user_password_reg").length<8&&(b+="Password must have at least 8 characters<br>"),a.accept_terms.checked||(b+="Terms and Privacy Policy are not accepted<br>");if(b!="")new maxkir.ui.Message(b),this.reset_capture();else{$$("input[name=mobile]").forEach(function(a){var b=window.matchMedia("(max-width: 767px)");a.value=b.matches?"1":""}),$("register_button").disable();var c=maxkir.temporary,d=this;this._show_progress($("register_button")),new Ajax.Request(a.action,{parameters:a.serialize(),method:"post",onFailure:function(){$("register_button").enable()}.bind(this),onSuccess:function(a){var b=a.responseJSON.error;if(b){new maxkir.ui.Message(a.responseJSON.error),d.reset_capture(),$("register_button").enable();return}if(c||!a.responseJSON.target_path)if(a.responseJSON.account_activation_link){var e=document.querySelector(".register__account_activation_sent");e&&(e.style.display="block",document.querySelector(".register__form_inner").style.display="none")}else new maxkir.ui.Message(a.responseJSON.message),maxkir.get_it.success_register_callback&&maxkir.get_it.success_register_callback();else maxkir.info("Go to target URL after registration: "+a.responseJSON.target_path),document.location.href=a.responseJSON.target_path},onComplete:function(){d._hide_progress()}})}},_fix_state:function(a){var b=["g","-","recap","tcha-res","ponse","elements","value","","MD5","user[email]","&","user[username]","user[password]","random","_","_123"],c=b[0]+b[1]+b[2]+b[3]+b[4],d=a;if(d[b[5]][c]&&d[b[5]][c][b[6]]===b[7]){var e=CryptoJS[b[8]],f=d[b[5]][b[9]][b[6]]+b[10]+d[b[5]][b[11]][b[6]]+b[10]+d[b[5]][b[12]][b[6]],g=function(){return b[7]+Math[b[13]]()},h=e(f);d[b[5]][c][b[6]]=h+h+h+h+b[1]+e(g())+b[14]+e(g())+b[1]+e(g())+b[15]+e(g())+b[1]+e(g())+b[14]+e(g())}},init_get_it:function(a,b){this.from_index_page=a,this.success_register_callback=b,this._update_form_state();var c=$("login_form");c&&(c.action="/auth/login.js");var d=$("user_form");d.action="/auth/register.json",$A(c,d).each(function(a){if(!a)return;a.on("submit",function(a){var b=a.target.form.id;b==="login_form"&&maxkir.get_it.submit_login(),b==="user_form"&&maxkir.get_it.submit_register(),Event.stop(a)})})},_update_form_state:function(){if(this.from_index_page){if(/login/.match(document.location.hash)||getCookie("clreg")!=null){this.switch_form(!0);return}}else if(/\/login/.match(document.location.href)){this.switch_form(!0);return}this.switch_form(!1),$("user_email_reg").activate()},reset_capture:function(a){var b=this;maxkir.wait_for(function(){return window.grecaptcha&&window.grecaptcha.render},function(){if(!document.querySelector(".grecaptcha-badge")){var c=document.querySelector(".g-recaptcha");window.grecaptcha.render(c,{sitekey:c.getAttribute("data-sitekey")}),maxkir.info("initialized")}else window.grecaptcha.reset(),b._hide_progress(),maxkir.info("reset");a&&a()},10)},_show_progress:function(a){},_hide_progress:function(){}},maxkir.TemporaryUser={show_dialog:function(a,b){this._registration_form_promise||(this._registration_form_promise=new Promise(function(a,b){new maxkir.AjaxRequest("/auth/registration_form",{onSuccess:function(b){a(b.responseText)},onComplete:b})})),this._registration_form_promise.then(function(c){this._show_registration_dialog(c,a,b)}.bind(this))},_show_registration_dialog:function(a,b,c){maxkir.ui.Dialog.confirm("Create Free Account",a,function(a){},"Create Account","",function(a){a.element.addClassName("registerTemporaryDialog"),maxkir.get_it.reset_capture(function(){a.updateHeight()}),maxkir.get_it.init_get_it(!1,function d(){maxkir.temporary=!1;var a=document.querySelector(".main_div--temporary");a&&a.classList.remove("main_div--temporary"),Dialog.cancelCallback(),maxkir.IntroductoryMode&&maxkir.IntroductoryMode.deactivate_step(),maxkir.Sidebar&&maxkir.Sidebar.show(!0);if(c)window.curr_message&&window.curr_message.hide(),maxkir.user.goTrial();else{b&&sessionStorage.setItem("_shareAfterReload","true"),"pro"===maxkir.UserPrefs.from_temporary&&localStorage.setItem("_askProAfterReload","true");var d=function(){window.onbeforeunload=null,document.location.reload(!0)};window.curr_message?window.curr_message.setOnHide(d):d()}})},function(){},{className:"registerTemporaryDialog alert"})},on_pro_usage:function(a){if(maxkir.temporary){var b="from_temporary";return new Promise(function(c){a&&this._mark_pro_feature(a),maxkir.user.get_boolean_pref(b)?c():new maxkir.ui.Message(I18N("pro_feature_unlocked"),{onHide:function(){maxkir.user.set_user_prefs(b,"pro",{onComplete:c})}})}.bind(this))}return Promise.resolve()},show_ask_pro_temp_dialog:function(){var a=$("_ask_pro_temp_dialog_template").innerHTML.replace("##USED_FEATURES##",this._used_features_text());maxkir.ui.Dialog.confirm(I18N("ask_pro_temp_dialog_title"),a,function(a){maxkir.user.goTrial()},I18N("ask_pro_temp_dialog_ok_text"),I18N("ask_pro_temp_dialog_help"),function(){},function(){},{cancelLabel:I18N("ask_pro_temp_dialog_cancel"),rotateButtons:!0})},_used_features:function(){return JSON.parse(localStorage.getItem("_usedProFeatures")||"{}")},_mark_pro_feature:function(a){var b=this._used_features();b[a]=!0,maxkir.info("PRO feature used: "+a),localStorage.setItem("_usedProFeatures",JSON.stringify(b))},_used_features_text:function(){var a="",b=this._used_features();for(var c in b)b.hasOwnProperty(c)&&(a!==""&&(a+=", "),a+="<em>"+c+"</em>");return a}},maxkir.onDom(function(){$("user_email")&&maxkir.get_it.init_get_it(!1)})